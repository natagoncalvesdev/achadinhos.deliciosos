
<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Achadinhos Deliciosos — Carregando...</title>
  <style>
    body {
      font-family: "Inter", "Segoe UI", system-ui, sans-serif;
      background: #f4f6fb;
      color: #0f172a;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
    }
    .loading-message {
      font-size: 1.2rem;
      color: #6b7280;
    }
  </style>
</head>
<body>
  <div class="loading-message">Carregando...</div>

<!-- ====== SCRIPT (usa Firebase modular via CDN) ====== -->
<script type="module">
const firebaseConfig = {
  apiKey: "AIzaSyDg83oO_NjNU_Tz9AKTfmsxYJY7vSkijyM",
  authDomain: "achadinhos-deliciosos.firebaseapp.com",
  projectId: "achadinhos-deliciosos",
  storageBucket: "achadinhos-deliciosos.appspot.com",
  messagingSenderId: "782203131056",
  appId: "1:782203131056:web:2c832412f81157cac1d775"
}

if (!firebaseConfig) {
  console.warn('Firebase config not set. Firestore operations will not run. Paste your firebaseConfig object in the script.');
}

  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
  import { getFirestore, doc, getDoc, setDoc } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
  import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
onAuthStateChanged(auth, async (user) => {
  if (user) {
    // Usuário está logado, buscar seu perfil no Firestore.
    const db = getFirestore(app);
    const userDocRef = doc(db, "users", user.uid);
    const userDoc = await getDoc(userDocRef);

    if (userDoc.exists()) {
      const userData = userDoc.data();
      switch (userData.categoria) {
        case 'adm':
          window.location.replace('adm.html');
          break;
        case 'profissional':
          window.location.replace('profissional.html');
          break;
        case 'cliente':
          window.location.replace('cliente.html');
          break;
        default:
          // Se a categoria for desconhecida, envia para a página de cliente como padrão
          window.location.replace('cliente.html');
      }
    } else {
      // O usuário existe no Auth, mas não no Firestore. Isso acontece se foi criado manualmente.
      // Vamos criar o documento de perfil para ele agora.
      console.warn(`Documento do usuário ${user.uid} não encontrado. Criando perfil padrão.`);
      
      const newUserProfile = {
        email: user.email,
        categoria: 'cliente', // Categoria padrão de segurança. Mude para 'adm' manualmente no Firestore.
        nome: user.email.split('@')[0], // Usa a parte local do email como nome padrão
        createdAt: new Date().toISOString()
      };

      await setDoc(userDocRef, newUserProfile);

      // Redireciona para a página de cliente, pois foi a categoria padrão criada.
      window.location.replace('cliente.html');
    }
  } else {
    // Usuário não está logado, redireciona para a página de login.
    console.log("Nenhum usuário autenticado. Redirecionando para o login...");
    window.location.replace('login.html');
  }
});

</script>
</body>
</html>
